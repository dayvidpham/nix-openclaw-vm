id: no-stringly-typed-args
language: Go
severity: error
message: >
  A string literal is used as a Status, Reason, or Decision field value in a struct
  literal. Use the typed enum constant instead (e.g., `DecisionDenied`, `ReasonAuthorizationDenied`).
  String literals at struct field boundaries bypass the type system and allow invalid values.
note: >
  Replace `Reason: "..."` with the appropriate DenialReason constant.
  Replace `Status: "..."` with the appropriate DecisionStatus or ProxyStatus constant.
  The typed enums are defined in credential-proxy/workflows/activities.go and proxy_workflow.go.
rule:
  any:
    - all:
        - pattern: $STRUCT{$$$, Status: "$VAL"}
        - regex: "Status:\s*\""
    - all:
        - pattern: $STRUCT{$$$, Reason: "$VAL"}
        - regex: "Reason:\s*\""
    - all:
        - pattern: $STRUCT{$$$, Decision: "$VAL"}
        - regex: "Decision:\s*\""
ignore:
  - "**/vendor/**"
